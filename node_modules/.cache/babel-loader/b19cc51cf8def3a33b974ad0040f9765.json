{"ast":null,"code":"import { getToken } from '@/utils/token';\nimport VueRouter from 'vue-router';\nimport routes from './routes';\nimport store from '../store/index';\nlet originPush = VueRouter.prototype.push;\nlet originReplace = VueRouter.prototype.replace;\n\nVueRouter.prototype.push = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originPush.call(this, location, resolve, reject);\n  } else {\n    originPush.call(this, location, () => {}, () => {});\n  }\n};\n\nVueRouter.prototype.replace = function (location, resolve, reject) {\n  if (resolve && reject) {\n    originReplace.call(this, location, resolve, reject);\n  } else {\n    originReplace.call(this, location, () => {}, () => {});\n  }\n};\n\nconst router = new VueRouter({\n  routes,\n\n  scrollBehavior(to, from, savedPosition) {\n    return {\n      y: 0,\n      behavior: 'smooth'\n    };\n  }\n\n});\nrouter.beforeEach((to, from, next) => {\n  let token = getToken();\n  let userName = store.state.user.name;\n\n  if (token) {\n    if (to.path == '/login') next(from);else {\n      if (userName) next();else {\n        store.dispatch('getUserInfo').then(next()).catch(error => {\n          store.dispatch('userLogOut').then(next('/login'));\n        });\n      }\n    }\n  } else {\n    let toPath = to.path;\n    const cantGo = ['/trade', '/pay', '/paySuccess'];\n    if (toPath in cantGo) next('/login');else {\n      next();\n    }\n  }\n});\nexport default router;","map":{"version":3,"names":["getToken","VueRouter","routes","store","originPush","prototype","push","originReplace","replace","location","resolve","reject","call","router","scrollBehavior","to","from","savedPosition","y","behavior","beforeEach","next","token","userName","state","user","name","path","dispatch","then","catch","error","toPath","cantGo"],"sources":["E:/学习/web前端/项目实践/尚品汇/尚品汇/app/src/router/index.js"],"sourcesContent":["import {\r\n    getToken\r\n} from '@/utils/token'\r\nimport VueRouter from 'vue-router'\r\nimport routes from './routes'\r\nimport store from '../store/index'\r\n\r\nlet originPush = VueRouter.prototype.push\r\nlet originReplace = VueRouter.prototype.replace\r\n\r\nVueRouter.prototype.push = function (location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originPush.call(this, location, resolve, reject)\r\n    } else {\r\n        originPush.call(this, location, () => {}, () => {})\r\n    }\r\n}\r\nVueRouter.prototype.replace = function (location, resolve, reject) {\r\n    if (resolve && reject) {\r\n        originReplace.call(this, location, resolve, reject)\r\n    } else {\r\n        originReplace.call(this, location, () => {}, () => {})\r\n    }\r\n}\r\n\r\nconst router = new VueRouter({\r\n    routes,\r\n    scrollBehavior(to, from, savedPosition) {\r\n        return {\r\n            y: 0,\r\n            behavior: 'smooth',\r\n        }\r\n    },\r\n\r\n})\r\nrouter.beforeEach((to, from, next) => {\r\n    let token = getToken()\r\n    let userName = store.state.user.name\r\n    if (token) {\r\n        if (to.path == '/login')\r\n            next(from)\r\n        else{\r\n            if(userName)\r\n                next()\r\n            else{\r\n                store.dispatch('getUserInfo')\r\n                .then(next())\r\n                .catch((error)=>{\r\n                    store.dispatch('userLogOut')\r\n                    .then(next('/login'))\r\n                })\r\n            }\r\n        }\r\n            \r\n    } else {\r\n        let toPath = to.path\r\n        const cantGo = ['/trade','/pay','/paySuccess']\r\n        if(toPath in cantGo)\r\n            next('/login')\r\n        else{\r\n            next()\r\n        }\r\n    }\r\n})\r\n\r\nexport default router"],"mappings":"AAAA,SACIA,QADJ,QAEO,eAFP;AAGA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AAEA,IAAIC,UAAU,GAAGH,SAAS,CAACI,SAAV,CAAoBC,IAArC;AACA,IAAIC,aAAa,GAAGN,SAAS,CAACI,SAAV,CAAoBG,OAAxC;;AAEAP,SAAS,CAACI,SAAV,CAAoBC,IAApB,GAA2B,UAAUG,QAAV,EAAoBC,OAApB,EAA6BC,MAA7B,EAAqC;EAC5D,IAAID,OAAO,IAAIC,MAAf,EAAuB;IACnBP,UAAU,CAACQ,IAAX,CAAgB,IAAhB,EAAsBH,QAAtB,EAAgCC,OAAhC,EAAyCC,MAAzC;EACH,CAFD,MAEO;IACHP,UAAU,CAACQ,IAAX,CAAgB,IAAhB,EAAsBH,QAAtB,EAAgC,MAAM,CAAE,CAAxC,EAA0C,MAAM,CAAE,CAAlD;EACH;AACJ,CAND;;AAOAR,SAAS,CAACI,SAAV,CAAoBG,OAApB,GAA8B,UAAUC,QAAV,EAAoBC,OAApB,EAA6BC,MAA7B,EAAqC;EAC/D,IAAID,OAAO,IAAIC,MAAf,EAAuB;IACnBJ,aAAa,CAACK,IAAd,CAAmB,IAAnB,EAAyBH,QAAzB,EAAmCC,OAAnC,EAA4CC,MAA5C;EACH,CAFD,MAEO;IACHJ,aAAa,CAACK,IAAd,CAAmB,IAAnB,EAAyBH,QAAzB,EAAmC,MAAM,CAAE,CAA3C,EAA6C,MAAM,CAAE,CAArD;EACH;AACJ,CAND;;AAQA,MAAMI,MAAM,GAAG,IAAIZ,SAAJ,CAAc;EACzBC,MADyB;;EAEzBY,cAAc,CAACC,EAAD,EAAKC,IAAL,EAAWC,aAAX,EAA0B;IACpC,OAAO;MACHC,CAAC,EAAE,CADA;MAEHC,QAAQ,EAAE;IAFP,CAAP;EAIH;;AAPwB,CAAd,CAAf;AAUAN,MAAM,CAACO,UAAP,CAAkB,CAACL,EAAD,EAAKC,IAAL,EAAWK,IAAX,KAAoB;EAClC,IAAIC,KAAK,GAAGtB,QAAQ,EAApB;EACA,IAAIuB,QAAQ,GAAGpB,KAAK,CAACqB,KAAN,CAAYC,IAAZ,CAAiBC,IAAhC;;EACA,IAAIJ,KAAJ,EAAW;IACP,IAAIP,EAAE,CAACY,IAAH,IAAW,QAAf,EACIN,IAAI,CAACL,IAAD,CAAJ,CADJ,KAEI;MACA,IAAGO,QAAH,EACIF,IAAI,GADR,KAEI;QACAlB,KAAK,CAACyB,QAAN,CAAe,aAAf,EACCC,IADD,CACMR,IAAI,EADV,EAECS,KAFD,CAEQC,KAAD,IAAS;UACZ5B,KAAK,CAACyB,QAAN,CAAe,YAAf,EACCC,IADD,CACMR,IAAI,CAAC,QAAD,CADV;QAEH,CALD;MAMH;IACJ;EAEJ,CAhBD,MAgBO;IACH,IAAIW,MAAM,GAAGjB,EAAE,CAACY,IAAhB;IACA,MAAMM,MAAM,GAAG,CAAC,QAAD,EAAU,MAAV,EAAiB,aAAjB,CAAf;IACA,IAAGD,MAAM,IAAIC,MAAb,EACIZ,IAAI,CAAC,QAAD,CAAJ,CADJ,KAEI;MACAA,IAAI;IACP;EACJ;AACJ,CA5BD;AA8BA,eAAeR,MAAf"},"metadata":{},"sourceType":"module"}